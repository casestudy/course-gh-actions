name: Gemini Butler 

on:
    issue_comment:
        types: [created]
    
    pull_request_review_comment:
        types: [created]

permissions:
    pull-requests: write
    issues: write
    contents: read

jobs:
    gemini-chat:
        if: startsWith(github.event.comment.body, '/ask') || startsWith(github.event.comment.body, '/review')
        runs-on: ubuntu-latest

        steps:
            -   name: Checkout repo
                uses: actions/checkout@v4

            -   name: Setup Python
                uses: actions/setup-python@v4
                with:
                    python-version: '3.x'

            -   name: Install Google Generative AI
                run: pip install google-genai

            -   name: Ask Gemini
                id: ask_gemini
                env:
                    GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
                    GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
                    REPO: ${{ github.repository }}
                    PR_OR_ISSUE_NUMBER: ${{ github.event.issue.number || github.event.pull_request.number }}
                    COMMENT_ID: ${{ github.event.comment.id }}
                    COMMENT_BODY: ${{ github.event.comment.body }}
                    EVENT_NAME: ${{ github.event_name }}
                run: |
                    python .github/scripts/python-scripts/gemini_butler.py